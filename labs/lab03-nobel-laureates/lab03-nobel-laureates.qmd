---
title: "Lab 03 - Nobel laureates"
link-citations: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(eval = TRUE)
```

En janvier 2017, Buzzfeed a publi√© un article sur pourquoi les laur√©ats du prix Nobel montrent que l‚Äôimmigration est si importante pour la science am√©ricaine. 

Vous pouvez lire l‚Äôarticle [ici](https://www.buzzfeednews.com/article/peteraldhous/immigration-and-science). Dans l‚Äôarticle, ils montrent que bien que la plupart des laur√©ats vivants du prix Nobel en sciences soient bas√©s aux √âtats-Unis, beaucoup d‚Äôentre eux sont n√©s dans d‚Äôautres pays. C‚Äôest une des raisons pour lesquelles le monde scientifique dit que l‚Äôimmigration est vitale pour le progr√®s. Dans ce lab, nous travaillerons avec les donn√©es de cet article pour recr√©er certaines de leurs visualisations ainsi qu‚Äôexplorer de nouvelles questions.

# Objectifs d‚Äôapprentissage

  - utiliser GitHub et R
  - R√©pliquer des r√©sultats publi√©s
  - Manipulation et visualisation de donn√©es

# Pr√©paration

Lire l‚Äôarticle de Buzzfeed intitul√© [*These Nobel Prize Winners Show Why Immigration Is So Important For American Science*](https://www.buzzfeednews.com/article/peteraldhous/immigration-and-science)*.* Nous r√©pliquerons cette analyse lors de l‚Äôatelier, il est donc crucial que vous en soyez familier √† l‚Äôavance.


# Pour commencer

Nous allons utiliser GitHub Classroom pour que vous puissiez rendre vos r√©ponses.
Sur le portail de cours, vous trouverez un lien vers un assignment.

  - Cliquez sur le lien
  - Connectez vous avec votre compte Github si ce n'est pas fait
  - Acceptez l'assignment
  - Liez votre compte avec votre nom d'√©tudiant
  
Vous devriez maintenant voir un repository appel√© `Lab03-[votre-username]` o√π devrait √™tre votre nom d'utilisateur GitHub.

Sur la page du repository:

  - Cliquez sur le bouton vert: ![](figs/github-bouton.png){.inline-image}
  - Copiez le lien terminant en `.git`
    - Quelque chose ressemblant √† `https://github.com/PRO1036/lab03-[votre-username].git`

Dans RStudio:

-   Fichier \> Nouveau Projet
-   Version Control \> Git
-   Dans *Repository URL* : indiquez l'adresse copi√©e √† l'√©tape pr√©c√©dente
-   Choisissez un nom pour le dossier qui sera cr√©√©, par exemple "Lab02"
-   Choisissez o√π vous voulez cr√©er le projet dans votre ordinateur.

Cela va copier les fichiers pr√©sents sur GitHub, et les copier dans le dossier sp√©cifi√©.
Dans le *YAML*, le `output` est r√©gl√© sur `"github_document"`. Cela permet d'obtenir un format adapt√© √† GitHub. Notamment, votre fichier final sera un fichier Markdown (`.md`).

## √âchauffement

Avant d‚Äôintroduire les donn√©es, commen√ßons par quelques exercices simples.

-   Mettez √† jour le YAML, en changeant le nom de l‚Äôauteur par le v√¥tre, et **knit** le document.
-   Committez vos modifications avec un message de commit. Assurez vous que les fichiers .Rmd et .md sont bien ajout√©s au commit.
-   Pushez  vos modifications sur GitHub.
-   Allez dans votre d√©p√¥t sur GitHub et confirmez que vos modifications sont visibles dans vos fichiers Rmd et md.

## Packages

Nous utiliserons le package **tidyverse** pour une grande partie de la manipulation des donn√©es.
Vous pouvez le charger en ex√©cutant ce qui suit dans votre Console :

```{r load-packages, message = FALSE}
library(tidyverse)
```

## Donn√©es

Le jeu de donn√©es pour cet exercice se trouve sous forme de fichier CSV (valeurs s√©par√©es par des virgules) dans le dossier data de votre d√©p√¥t. Vous pouvez les charger avec :

```{r load-data, message = FALSE}
nobel <- read_csv("data/nobel.csv")
```

Les descriptions des variables sont les suivantes :

-   `id`: Num√©ro d‚Äôidentification
-   `firstname`: Pr√©nom du laur√©at ou de la laur√©ate
-   `surname`: Nom de famille
-   `year`: Ann√©e de remise du prix
-   `category`: Cat√©gorie du prix
-   `affiliation`: Affiliation du ou de la laur√©at¬∑e
-   `city`: Ville de r√©sidence de la personne laur√©ate l‚Äôann√©e du prix
-   `country`: Pays de r√©sidence de la personne laur√©ate l‚Äôann√©e du prix
-   `born_date`: Date de naissance du ou de la laur√©at¬∑e
-   `died_date`: Date de d√©c√®s
-   `gender`: Sexe
-   `born_city`: Ville de naissance
-   `born_country`: Pays de naissance de la personne laur√©ate
-   `born_country_code`: Code du pays de naissance
-   `died_city`: Ville de d√©c√®s
-   `died_country`: Pays de d√©c√®s
-   `died_country_code`: Code du pays de d√©c√®s
-   `overall_motivation`: Motivation g√©n√©rale pour la reconnaissance
-   `share`: Nombre d‚Äôautres personnes laur√©ates avec lesquels le prix est partag√©
-   `motivation`: Motivation pour la reconnaissance

Dans quelques cas, le nom de la ville/pays a chang√© apr√®s la r√©ception du prix par le ou la laur√©ate (par exemple, en 1975, la Bosnie-Herz√©govine s‚Äôappelait la R√©publique f√©d√©rative socialiste de Yougoslavie). Dans ces cas, les variables ci-dessous refl√®tent un nom diff√©rent de leurs homologues sans le suffixe \`\_original\`.

-   `born_country_original`
-   `born_city_original`
-   `died_country_original`
-   `died_city_original`
-   `city_original`
-   `country_original`

# Exercices

## Faites connaissance avec les donn√©es

### Exercice 1
Combien d‚Äôobservations et combien de variables y a-t-il dans le jeu de donn√©es ? Que repr√©sente chaque ligne ?

Il y a quelques observations dans ce jeu de donn√©es que nous exclurons de notre analyse pour correspondre aux r√©sultats de Buzzfeed.

### Exercice 2
Cr√©ez un nouveau dataframe appel√© `nobel_living` qui filtre pour

- les laur√©ates et laur√©ats pour lesquels `country` est disponible
- les laur√©ates et laur√©ats qui sont des personnes par opposition aux organisations (les organisations sont d√©sign√©es par `org` dans la variable `gender`)
- les laur√©ates et laur√©ats qui sont encore en vie (leur `died_date` vaut `NA`)

Pour "cr√©er un nouveau dataframe", nous allons modifier le tableau `nobel` existant et attribuer le r√©sultat √† un nouvelle variable appel√©e `nobel_living`. L'attribution se fait avec le symbole `<-`. Le bloc de code suivant montre comment commencer le pipeline avec `nobel` et l'assigner √† `nobel_living`. Vous devez compl√©ter le code en ajoutant la fonction `filter()` avec les conditions appropri√©es.

```{r echo=TRUE, eval=FALSE}
nobel_living <- nobel %>%
  filter(
    # votre code ici
  )
```



```{r echo=FALSE}
nobel_living <- nobel %>%
  filter(
    !is.na(country),
    gender != "org",
    is.na(died_date)
  )
```

V√©rifiez que vous obtenez bien un data frame avec `r nrow(nobel_living)` observations apr√®s avoir filtr√© les donn√©es.

üß∂ ‚úÖ ‚¨ÜÔ∏è 
*Knit, commit, and push ! N'oubliez pas le message de commit.*

## "La plupart des laur√©ates et laur√©ats encore vivants √©taient bas√©s aux √âtats-Unis lorsqu‚Äôils ont remport√© leurs prix"

... dit l‚Äôarticle de Buzzfeed. Voyons si c‚Äôest vrai.

Tout d‚Äôabord, nous allons cr√©er une nouvelle variable, c'est-√†-dire une nouvelle colonne, pour identifier si la personne laur√©ate vivait aux √âtats-Unis lorsqu'elle a remport√© son prix. Pour cela, nous utiliserons la fonction `mutate()`. Le pipeline suivant modifie le data frame `nobel_living` en ajoutant une nouvelle variable appel√©e `country_us`. Nous utilisons une instruction Si-Sinon pour cr√©er cette variable. Le premier argument dans la fonction `if_else()` est la condition que nous testons. *Si* `country` est √©gal √† `"USA"`, nous d√©finissons `country_us` √† `"USA"`. *Sinon*, nous d√©finissons `country_us` √† `"Other"`


```{r}
nobel_living <- nobel_living %>%
  mutate(
    country_us = if_else(country == "USA", "USA", "Other")
  )
```

### Exercice 3

Pour la suite de ce travail, nous limiterons notre analyse aux cat√©gories suivantes : Physique, M√©decine, Chimie et √âconomie. Cr√©ez un nouveau dataframe appel√© `nobel_living_science` qui filtre pour les cat√©gories suivantes : Physique, M√©decine, Chimie et √âconomie.

Pour cela, vous pouvez tester si la variable `category` est dans le vecteur `c("Physics", "Medicine", "Chemistry", "Economics")`. Pour cela, utilisez l‚Äôop√©rateur `%in%` dans la fonction `filter()`. Une solution alternative serait de utiliser l‚Äôop√©rateur logique **ou** pour tester chaque cat√©gorie s√©par√©ment, mais l‚Äôutilisation de `%in%` est plus concise.

```{r echo=FALSE}
nobel_living_science <- nobel_living %>%
  filter(category %in% c("Physics", "Medicine", "Chemistry", "Economics"))
```

### Exercice 4

Pour le prochain exercice, travaillez avec le data frame `nobel_living_science` que nous avons cr√©√© ci-dessus.

Cr√©ez un graphique √† barres avec des facets visualisant la relation entre la cat√©gorie du prix Nobel et si la personne lau√©rate √©tait aux √âtats-Unis lorsqu‚Äôelle l'a remport√©. 

Interpr√©tez votre visualisation et commentez le titre de Buzzfeed en regardant s'il est soutenu par les donn√©es.

  - Votre visualisation doit √™tre facett√©e par cat√©gorie.
  - Pour chaque facette, vous devez avoir deux barres, une pour les personnes aux √âtats-Unis et une pour les autres.
  - Inversez les coordonn√©es pour que les barres soient horizontales et non verticales.

üß∂ ‚úÖ ‚¨ÜÔ∏è 
*Knit, commit, and push ! N'oubliez pas le message de commit.*

## "Mais parmi ces laur√©at¬∑es du prix Nobel bas√©¬∑es aux √âtats-Unis, beaucoup sont n√©¬∑es dans d‚Äôautres pays"

### Exercice 5

Cr√©ez une nouvelle variable appel√©e `born_country_us` qui a la valeur `"USA"` si la personne laur√©ate est n√©e aux √âtats-Unis, et `"Other"` sinon. Combien de laur√©at¬∑es sont n√©¬∑es aux √âtats-Unis ?

### Exercice 6

Ajoutez une deuxi√®me variable √† votre visualisation de l‚Äôexercice 4 bas√©e sur si la personne est n√©e aux √âtats-Unis ou non. D‚Äôapr√®s votre visualisation, les donn√©es semblent-elles soutenir l‚Äôaffirmation de Buzzfeed ? Expliquez votre raisonnement en 1-2 phrases.

  - Votre visualisation finale doit contenir une facette pour chaque cat√©gorie.
  - Dans chaque facette, il doit y avoir une barre pour savoir si la personne laur√©ate a remport√© le prix aux √âtats-Unis ou non.
  - Chaque barre doit avoir des segments pour savoir si le ou la laur√©ate est n√©e aux √âtats-Unis ou non.


üß∂ ‚úÖ ‚¨ÜÔ∏è 
*Knit, commit, and push ! N'oubliez pas le message de commit.*

## D'o√π viennent les laur√©ats n√©s √† l'√©tranger qui ont remport√© leur prix aux √âtats-Unis ?

:::{.callout-note}
Notez que votre graphique √† barres ne correspondra pas exactement √† celui de l'article de Buzzfeed. C'est probablement parce que les donn√©es ont √©t√© mises √† jour depuis la publication de l'article.
:::

### Exercice 7

Dans un seul pipeline, filtrez pour les laur√©at¬∑es qui ont remport√© leur prix aux √âtats-Unis, mais qui sont n√©es en dehors des √âtats-Unis, puis cr√©ez un tableau de fr√©quence (avec la fonction `count()`) pour leur pays de naissance (`born_country`) et arrangez le dataframe r√©sultant par ordre d√©croissant du nombre d'observations pour chaque pays. Quel pays est le plus commun ?

üß∂ ‚úÖ ‚¨ÜÔ∏è 
*Knit, commit, and push ! N'oubliez pas le message de commit.*

Maintenant, relisez votre rapport pour vous assurer que vous avez r√©pondu √† toutes les questions et que tous vos blocs de code R sont correctement √©tiquet√©s. Vous pouvez faire un dernier **Knit** pour g√©n√©rer le fichier Markdown final. Committez et poussez vos modifications sur GitHub.

# Int√©ress√© par la fa√ßon dont Buzzfeed a r√©alis√© leurs visualisations ?

Les graphiques dans l'article de Buzzfeed sont appel√©s des graphiques en gaufre (_waffle plots_).
Vous pouvez trouver le code utilis√© pour r√©aliser ces graphiques dans le d√©p√¥t GitHub de Buzzfeed (oui, ils en ont un !) [ici](https://buzzfeednews.github.io/2017-01-immigration-and-science/).
Vous pouvez essayer de recr√©er ces graphiques pour le plaisir, mais ce n'est pas une exigence pour ce lab.